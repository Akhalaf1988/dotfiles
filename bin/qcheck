#! /usr/bin/env bash

readonly AWK='/bin/awk'
readonly ECHO='/bin/echo'
readonly GREP='/bin/grep'

U="$(~iworx/bin/listaccounts.pex | awk '{print $1}')"
D="$(for i in {1..23}; do "$ECHO" -n "-"; done)"
R="$(for x in $(~iworx/bin/listaccounts.pex | "$AWK" '{print $1}'); do sudo quota -sg "$x"; done \
| "$GREP" "/dev" | "$AWK" '{print $2, $3}')"
L="$("$ECHO" "$R" | "$GREP" "*")"

_getquota(){
"$ECHO" "Over Quota"
"$ECHO" "$D"
paste -d ' | ' <("$ECHO" "$U") <("$ECHO" "$R") | "$GREP" "*"
"$ECHO" "$D"
}
if [[ -z "$L" ]]; then
     "$ECHO" ""
  else
     _getquota
fi
